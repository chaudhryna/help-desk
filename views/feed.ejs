<%- include('partials/header') -%>
<%- include('partials/navbar') -%>

  <div class="container">
    <div class="row justify-content-center mt-5">
      <h2>All Tickets</h2>
      <hr />
      
      <ul class="row list-unstyled">
        <% for(var i=0; i<tickets.length; i++) {%>
          <li class="col mt-5">

            <div class="card shadow p-3 mb-5 bg-body rounded" style="width: 25rem;">
              <div class="card-body">
                <h5 class="card-title">Ticket: <%= tickets[i]._id %></h5>
                <h6 class="card-subtitle mb-2 text-muted">Opened by: <%= tickets[i].user.firstName %> <%= tickets[i].user.lastName %></h6>
                <p class="card-text">
                  <span class="text-muted">Subject:</span> <%= tickets[i].shortDesc %>
                </p>
                <% if (tickets[i].assignedTech)  {%>
                  <p class="card-text">
                    <span class="text-muted">Assigned Tech: </span><%= tickets[i].assignedTech.firstName %> 
                    <%= tickets[i].assignedTech.lastName %>
                  </p>
                  <p class="text-muted">Status: <span class="status">
                    <%= tickets[i].status %>
                  </span></p>
                <% } %>
                <% if (user.role === 'Customer') {%>
                  <a href="/ticket/<%= tickets[i]._id%>" class="btn btn-primary">Ticket Details</a>
                <% } else { %>
                  <a href="/ticket/updateTicket/<%= tickets[i]._id%>" class="btn btn-primary">Update Ticket</a>
                <% } %>
              </div>
            </div>
  
          </li>
        <% } %>
        </ul>
    </div>
  </div>  

<%- include('partials/footer') -%>